<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PocketBase Setup Utility (Token Auth)</title>
    <script src="pocketbase.umd.js"></script> <!-- Make sure this path is correct -->
    <style>
        body { font-family: sans-serif; padding: 20px; line-height: 1.6; }
        .container { max-width: 600px; margin: auto; padding: 20px; border: 1px solid #ccc; border-radius: 5px; }
        label { display: block; margin-bottom: 5px; }
        input[type="text"], input[type="url"] { width: 95%; padding: 8px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 3px; }
        textarea { width: 95%; padding: 8px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 3px; min-height: 60px; }
        button { padding: 10px 15px; background-color: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        pre { background-color: #f4f4f4; padding: 10px; border: 1px solid #eee; white-space: pre-wrap; word-wrap: break-word; max-height: 300px; overflow-y: auto; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <div class="container">
        <h1>PocketBase Initial Setup Utility (Using Admin Token)</h1>
        <p>This utility will attempt to create collections and seed data using a provided Admin JWT.
           <strong>Ensure the token is valid, has admin privileges, and understand the security implications if this page is accessible to others.</strong>
        </p>
        
        <div>
            <label for="pb_url">PocketBase URL (e.g., http://127.0.0.1:8090 or your https://a4.48d1.cc):</label>
            <input type="url" id="pb_url" value="https://a4.48d1.cc">
        </div>
        <div>
            <label for="admin_token">Admin JWT Token:</label>
            <textarea id="admin_token" placeholder="Paste your admin JWT here..."></textarea>
        </div>
        <button onclick="runSetupWithToken()">Run Setup / Seed Database with Token</button>

        <hr style="margin: 20px 0;">
        <h3>Log:</h3>
        <pre id="logOutput">Setup log will appear here...</pre>
    </div>

    <script>
        const logElement = document.getElementById('logOutput');

        function log(message, type = 'info') {
            const line = document.createElement('div');
            line.textContent = `[${type.toUpperCase()}] ${new Date().toLocaleTimeString()}: ${message}`;
            if (type === 'error') line.style.color = 'red';
            if (type === 'success') line.style.color = 'green';
            logElement.appendChild(line);
            logElement.scrollTop = logElement.scrollHeight;
            console[type === 'error' ? 'error' : 'log'](message);
        }
        
        function generateSetupId(prefix = 'setup_') { 
            return prefix + Date.now().toString(36).slice(-3) + Math.random().toString(36).substr(2, 3);
        }

        // --- SCHEMA DEFINITIONS (Same as before) ---
        const plannersCollectionSchema = {
            name: "planners", type: "base", system: false, listRule: "", viewRule: "", createRule: "", updateRule: "", deleteRule: "", options: {},
            schema: [
                // { name: "user", type: "relation", system: false, required: false, options: { collectionId: "users", cascadeDelete: false, minSelect: null, maxSelect: 1 }},
                { name: "week_id", type: "text", system: false, required: true, unique: true, presentable: true, options: { pattern: "^\\d{4}-W(0[1-9]|[1-4][0-9]|5[0-3])$"}},
                { name: "date_range", type: "text", system: false, required: false, options: {}},
                { name: "planner_title", type: "text", system: false, required: false, presentable: true, options: {}},
                { name: "ui_config", type: "json", system: false, required: false, options: {maxSize:524288}},
                { name: "times_display", type: "json", system: false, required: false, options: {maxSize:10240}},
                { name: "schedule_data", type: "json", system: false, required: false, options: {maxSize:2097152}},
                { name: "tasks_data", type: "json", system: false, required: false, options: {maxSize:1048576}},
                { name: "workout_plan_data", type: "json", system: false, required: false, options: {maxSize:524288}},
                { name: "meals_data", type: "json", system: false, required: false, options: {maxSize":524288}},
                { name: "grocery_budget", type: "text", system: false, required: false, options: {}},
                { name: "grocery_list_data", type: "json", system: false, required: false, options: {maxSize":524288}},
                { name: "body_measurements_data", type: "json", system: false, required: false, options: {maxSize":524288}},
                { name: "financials_data", type: "json", system: false, required: false, options: {maxSize":524288}}
            ]
        };
        const appConfigCollectionSchema = {
            name: "app_config", type: "base", system: false, listRule: "", viewRule: "", createRule: "@request.auth.admin = true", updateRule: "@request.auth.admin = true", deleteRule: "@request.auth.admin = true", options: {},
            schema: [
              { name: "config_key", type: "text", system: false, required: true, unique: true, presentable: true, options: {min:1, pattern:"default_v[0-9]+"}},
              { name: "planner_title_default", type: "text", system: false, required: false, options: {}},
              { name: "ui_config_default", type: "json", system: false, required: false, options: {maxSize:524288}},
              { name: "times_default", type: "json", system: false, required: false, options: {maxSize:10240}},
              { name: "schedule_default", type: "json", system: false, required: false, options: {maxSize:2097152}},
              { name: "tasks_default_count", type: "number", system: false, required: false, options: {min:0,max:100,noDecimal:true}},
              { name: "workout_plan_default", type: "json", system: false, required: false, options: {maxSize":524288}},
              { name: "meals_default", type: "json", system: false, required: false, options: {maxSize":524288}},
              { name: "grocery_list_default", type: "json", system: false, required: false, options: {maxSize":524288}},
              { name: "grocery_budget_default_placeholder", type: "text", system: false, required: false, options: {}},
              { name: "body_measurements_default", type: "json", system: false, required: false, options: {maxSize":524288}},
              { name: "financials_default", type: "json", system: false, required: false, options: {maxSize":524288}}
            ]
        };

        // --- FULL SEED DATA (From your original script.js) ---
        const SEED_APP_CONFIG_RECORD_DATA = { /* ... PASTE YOUR FULL SEED_APP_CONFIG_RECORD_DATA from the previous db_seed.js ... */ 
            config_key: "default_v1",
            planner_title_default: "Weekly Planner (Seeded via HTML Utility)",
            ui_config_default: { mainTableHeaders: ['TIME', 'DAY', 'ACTIVITY', 'SCR', 'MAX', 'üî•'], dayHeaders: ['MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT', 'SUN'], maxHeaders: Array(7).fill('MAX'), taskHeaders: ['‚Ññ', 'üî•', 'üè∑Ô∏è', '‚úèÔ∏è Task/Event/Note', 'üìÖ', '‚úì'], sectionTitles: { tasks: 'TASKS & NOTES', workout: 'WORKOUT PLAN', meals: 'MEAL PREP', grocery: 'GROCERY LIST', measurements: 'BODY MEASUREMENTS', financials: 'MONTH/1ST: FINANCIAL'} },
            times_default: [ { label: 'Q', value: '' }, { label: 'F', value: '' }, { label: 'D', value: '' }, { label: 'A', value: '' }, { label: 'M', value: '' }, { label: 'I', value: '' } ],
            schedule_default: [ { name: 'QIYAM', id: generateSetupId('sec_'), activities: [ { id: generateSetupId('act_'), name: 'DAILY: Wakeup early', days: { mon: { value: '', max: 1 }, tue: { value: '', max: 1 }, wed: { value: '', max: 1 }, thu: { value: '', max: 1 }, fri: { value: '', max: 1 }, sat: { value: '', max: 1 }, sun: { value: '', max: 1 } }, score: 0, maxScore: 7, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 }}, { id: generateSetupId('act_'), name: 'DAILY: Qiyam/Tahajjud', days: { mon: { value: '', max: 1 }, tue: { value: '', max: 1 }, wed: { value: '', max: 1 }, thu: { value: '', max: 1 }, fri: { value: '', max: 1 }, sat: { value: '', max: 1 }, sun: { value: '', max: 1 } }, score: 0, maxScore: 7, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 }}, { id: generateSetupId('act_'), name: 'DAILY: Nutty Pudding', days: { mon: { value: '', max: 1 }, tue: { value: '', max: 1 }, wed: { value: '', max: 1 }, thu: { value: '', max: 1 }, fri: { value: '', max: 1 }, sat: { value: '', max: 1 }, sun: { value: '', max: 1 } }, score: 0, maxScore: 7, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 }} ]}, { name: 'FAJR', id: generateSetupId('sec_'), activities: [ { id: generateSetupId('act_'), name: 'DAILY: Fajr prayer', days: { mon: { value: '', max: 1 }, tue: { value: '', max: 1 }, wed: { value: '', max: 1 }, thu: { value: '', max: 1 }, fri: { value: '', max: 1 }, sat: { value: '', max: 1 }, sun: { value: '', max: 1 } }, score: 0, maxScore: 7, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 }}, { id: generateSetupId('act_'), name: 'DAILY: Quran - 1 Juz', days: { mon: { value: '', max: 1 }, tue: { value: '', max: 1 }, wed: { value: '', max: 1 }, thu: { value: '', max: 1 }, fri: { value: '', max: 1 }, sat: { value: '', max: 1 }, sun: { value: '', max: 1 } }, score: 0, maxScore: 7, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 }}, { id: generateSetupId('act_'), name: 'DAILY: 5min Cold Shower', days: { mon: { value: '', max: 1 }, tue: { value: '', max: 1 }, wed: { value: '', max: 1 }, thu: { value: '', max: 1 }, fri: { value: '', max: 1 }, sat: { value: '', max: 1 }, sun: { value: '', max: 1 } }, score: 0, maxScore: 7, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 }} ]}, { name: '7AM - 9AM', id: generateSetupId('sec_'), activities: [ { id: generateSetupId('act_'), name: 'MON/THU: COMMUTE', days: { mon: { value: '', max: 1 }, thu: { value: '', max: 1 } }, score: 0, maxScore: 2, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } }, { id: generateSetupId('act_'), name: 'TUE/WED/FRI: Reading/Study (book/course/skill)', days: { tue: { value: '', max: 1 }, wed: { value: '', max: 1 }, fri: { value: '', max: 1 } }, score: 0, maxScore: 3, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } }, { id: generateSetupId('act_'), name: 'SAT: Errands, Grocery shopping, Meal prep', days: { sat: { value: '', max: 3 } }, score: 0, maxScore: 3, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } }, { id: generateSetupId('act_'), name: 'SUN: House cleaning, laundry', days: { sun: { value: '', max: 2 } }, score: 0, maxScore: 2, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } } ]}, { name: '9AM - 5PM', id: generateSetupId('sec_'), activities: [ { id: generateSetupId('act_'), name: 'MON - FRI: Work', days: { mon: { value: '', max: 1 }, tue: { value: '', max: 1 }, wed: { value: '', max: 1 }, thu: { value: '', max: 1 }, fri: { value: '', max: 1 } }, score: 0, maxScore: 5, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } }, { id: generateSetupId('act_'), name: 'DAILY: ZeroInbox (E1, E2, E3, E4, LI, Slack)', days: { mon: { value: '', max: 6 }, tue: { value: '', max: 6 }, wed: { value: '', max: 6 }, thu: { value: '', max: 6 }, fri: { value: '', max: 6 } }, score: 0, maxScore: 30, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } }, { id: generateSetupId('act_'), name: 'SAT/SUN: Nature time / Outdoor Activity / Adventure', days: { sat: { value: '', max: 1 }, sun: { value: '', max: 1 } }, score: 0, maxScore: 2, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } } ]}, { name: 'DHUHR', id: generateSetupId('sec_'), activities: [ { id: generateSetupId('act_'), name: 'DAILY: Dhuhr prayer', days: { mon: { value: '', max: 1 }, tue: { value: '', max: 1 }, wed: { value: '', max: 1 }, thu: { value: '', max: 1 }, fri: { value: '', max: 1 }, sat: { value: '', max: 1 }, sun: { value: '', max: 1 } }, score: 0, maxScore: 7, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } }, { id: generateSetupId('act_'), name: 'TUE/WED/FRI: Sun walk (30-45 minutes)', days: { tue: { value: '', max: 1 }, wed: { value: '', max: 1 }, fri: { value: '', max: 1 } }, score: 0, maxScore: 3, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } }, { id: generateSetupId('act_'), name: 'FRI: ¬£10 Sadaqa', days: { fri: { value: '', max: 1 } }, score: 0, maxScore: 1, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } } ]}, { name: 'ASR', id: generateSetupId('sec_'), activities: [ { id: generateSetupId('act_'), name: 'DAILY: Asr prayer', days: { mon: { value: '', max: 1 }, tue: { value: '', max: 1 }, wed: { value: '', max: 1 }, thu: { value: '', max: 1 }, fri: { value: '', max: 1 }, sat: { value: '', max: 1 }, sun: { value: '', max: 1 } }, score: 0, maxScore: 7, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } } ]}, { name: '5PM - 6:30PM', id: generateSetupId('sec_'), activities: [ { id: generateSetupId('act_'), name: 'MON/THU: COMMUTE', days: { mon: { value: '', max: 1 }, thu: { value: '', max: 1 } }, score: 0, maxScore: 2, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } }, { id: generateSeedId('act_'), name: 'TUE/WED/FRI: Workout', days: { tue: { value: '', max: 1 }, wed: { value: '', max: 1 }, fri: { value: '', max: 1 } }, score: 0, maxScore: 3, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } }, { id: generateSeedId('act_'), name: 'TUE/WED/FRI: Third Meal', days: { tue: { value: '', max: 1 }, wed: { value: '', max: 1 }, fri: { value: '', max: 1 } }, score: 0, maxScore: 3, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } } ]}, { name: '6:30PM - ISHA', id: generateSeedId('sec_'), activities: [ { id: generateSeedId('act_'), name: 'MON/TUE/WED/THU: Personal', days: { mon: { value: '', max: 1 }, tue: { value: '', max: 1 }, wed: { value: '', max: 1 }, thu: { value: '', max: 1 } }, score: 0, maxScore: 4, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } }, { id: generateSeedId('act_'), name: 'DAILY: Family/Friends/Date calls(M, WA, Phone)', days: { mon: { value: '', max: 3 }, tue: { value: '', max: 3 }, wed: { value: '', max: 3 }, thu: { value: '', max: 3 } }, score: 0, maxScore: 12, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } }, { id: generateSeedId('act_'), name: 'FRI/SAT/SUN: Family/Friends/Date visits/outings/activities', days: { fri: { value: '', max: 3 }, sat: { value: '', max: 3 }, sun: { value: '', max: 3 } }, score: 0, maxScore: 9, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } } ]}, { name: 'MAGHRIB', id: generateSeedId('sec_'), activities: [ { id: generateSeedId('act_'), name: 'DAILY: Maghrib prayer', days: { mon: { value: '', max: 1 }, tue: { value: '', max: 1 }, wed: { value: '', max: 1 }, thu: { value: '', max: 1 }, fri: { value: '', max: 1 }, sat: { value: '', max: 1 }, sun: { value: '', max: 1 } }, score: 0, maxScore: 7, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } }, { id: generateSeedId('act_'), name: 'DAILY: Super Veggie', days: { mon: { value: '', max: 1 }, tue: { value: '', max: 1 }, wed: { value: '', max: 1 }, thu: { value: '', max: 1 }, fri: { value: '', max: 1 }, sat: { value: '', max: 1 }, sun: { value: '', max: 1 } }, score: 0, maxScore: 7, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } } ]}, { name: 'ISHA', id: generateSeedId('sec_'), activities: [ { id: generateSeedId('act_'), name: 'DAILY: Isha prayer', days: { mon: { value: '', max: 1 }, tue: { value: '', max: 1 }, wed: { value: '', max: 1 }, thu: { value: '', max: 1 }, fri: { value: '', max: 1 }, sat: { value: '', max: 1 }, sun: { value: '', max: 1 } }, score: 0, maxScore: 7, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } }, { id: generateSeedId('act_'), name: 'DAILY: Sleep early', days: { mon: { value: '', max: 1 }, tue: { value: '', max: 1 }, wed: { value: '', max: 1 }, thu: { value: '', max: 1 }, fri: { value: '', max: 1 }, sat: { value: '', max: 1 }, sun: { value: '', max: 1 } }, score: 0, maxScore: 7, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } } ]}, { name: 'ALLDAY', id: generateSeedId('sec_'), activities: [ { id: generateSeedId('act_'), name: 'DAILY: No Doomscrolling; (FB, YTB, LKDN, & IG)', days: { mon: { value: '', max: 4 }, tue: { value: '', max: 4 }, wed: { value: '', max: 4 }, thu: { value: '', max: 4 }, fri: { value: '', max: 4 }, sat: { value: '', max: 4 }, sun: { value: '', max: 4 } }, score: 0, maxScore: 28, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } }, { id: generateSeedId('act_'), name: 'DAILY: No Fap; (P, & M)', days: { mon: { value: '', max: 2 }, tue: { value: '', max: 2 }, wed: { value: '', max: 2 }, thu: { value: '', max: 2 }, fri: { value: '', max: 2 }, sat: { value: '', max: 2 }, sun: { value: '', max: 2 } }, score: 0, maxScore: 14, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } }, { id: generateSeedId('act_'), name: 'DAILY: No Processed; (Sugar, RefinedFlour, SeedOils, Soda, FastFood)', days: { mon: { value: '', max: 5 }, tue: { value: '', max: 5 }, wed: { value: '', max: 5 }, thu: { value: '', max: 5 }, fri: { value: '', max: 5 }, sat: { value: '', max: 5 }, sun: { value: '', max: 5 } }, score: 0, maxScore: 35, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } }, { id: generateSeedId('act_'), name: 'MON/THU: Fasting', days: { mon: { value: '', max: 1 }, thu: { value: '', max: 1 } }, score: 0, maxScore: 2, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } }, { id: generateSeedId('act_'), name: 'DAILY: Expense Tracker <25', days: { mon: { value: '', max: 0 }, tue: { value: '', max: 0 }, wed: { value: '', max: 0 }, thu: { value: '', max: 0 }, fri: { value: '', max: 0 }, sat: { value: '', max: 0 }, sun: { value: '', max: 0 } }, score: 0, maxScore: 0, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 } } ]}, { name: 'TOTAL', id: generateSeedId('sec_'), activities: [ { id: generateSeedId('act_'), name: 'DAILY POINTS', days: { mon: { value: '0', max: 0 }, tue: { value: '0', max: 0 }, wed: { value: '0', max: 0 }, thu: { value: '0', max: 0 }, fri: { value: '0', max: 0 }, sat: { value: '0', max: 0 }, sun: { value: '0', max: 0 } }, score: 0, maxScore: 0, streaks: { mon:0, tue:0, wed:0, thu:0, fri:0, sat:0, sun:0, current:0, longest:0 }} ]}
        ],
        tasks_default_count: 20,
        workout_plan_default: [ { name: 'TUESDAY', id: generateSeedId('wpd_'), exercises: [ { id: generateSeedId('ex_'), prefix: '‚Ä¢ ', name: 'Incline Dumbbell Press', weight: '', sets: '', reps: '', defaultWeight: '30', defaultSets: '3', defaultReps: '12' }, { id: generateSeedId('ex_'), prefix: '‚Ä¢ ', name: 'Barbell Squats', weight: '', sets: '', reps: '', defaultWeight: '80', defaultSets: '3', defaultReps: '8' }, { id: generateSeedId('ex_'), prefix: '‚Ä¢ ', name: 'DB Chest-Supported Row', weight: '', sets: '', reps: '', defaultWeight: '25', defaultSets: '3', defaultReps: '12' }, { id: generateSeedId('ex_'), prefix: '‚Ä¢ ', name: 'Leg Curls', weight: '', sets: '', reps: '', defaultWeight: '40', defaultSets: '3', defaultReps: '15' }, { id: generateSeedId('ex_'), prefix: '‚Ä¢ SS: ', name: 'Incline DB Curls', weight: '', sets: '', reps: '', defaultWeight: '15', defaultSets: '3', defaultReps: '12' }, { id: generateSeedId('ex_'), prefix: '‚Ä¢ SS: ', name: 'Tricep Extensions', weight: '', sets: '', reps: '', defaultWeight: '20', defaultSets: '3', defaultReps: '12' } ]}, { name: 'WEDNESDAY', id: generateSeedId('wpd_'), exercises: [ { id: generateSeedId('ex_'), prefix: '‚Ä¢ ', name: 'Barbell Bench Press', weight: '', sets: '', reps: '', defaultWeight: '70', defaultSets: '3', defaultReps: '6' }, { id: generateSeedId('ex_'), prefix: '‚Ä¢ ', name: 'Romanian Deadlift', weight: '', sets: '', reps: '', defaultWeight: '90', defaultSets: '3', defaultReps: '8' }, { id: generateSeedId('ex_'), prefix: '‚Ä¢ ', name: 'Lat Pulldown', weight: '', sets: '', reps: '', defaultWeight: '60', defaultSets: '3', defaultReps: '12' }, { id: generateSeedId('ex_'), prefix: '‚Ä¢ ', name: 'Walking Lunges', weight: '', sets: '', reps: '', defaultWeight: '20', defaultSets: '3', defaultReps: '10' }, { id: generateSeedId('ex_'), prefix: '‚Ä¢ SS: ', name: 'Cable Lateral Raises', weight: '', sets: '', reps: '', defaultWeight: '15', defaultSets: '3', defaultReps: '15' }, { id: generateSeedId('ex_'), prefix: '‚Ä¢ SS: ', name: 'Reverse Crunches', weight: '', sets: '', reps: '', defaultWeight: '0', defaultSets: '3', defaultReps: '15' } ]}, { name: 'FRIDAY', id: generateSeedId('wpd_'), exercises: [ { id: generateSeedId('ex_'), prefix: '‚Ä¢ ', name: 'Seated DB Shoulder Press', weight: '', sets: '', reps: '', defaultWeight: '20', defaultSets: '3', defaultReps: '12' }, { id: generateSeedId('ex_'), prefix: '‚Ä¢ ', name: 'Dumbbell Row', weight: '', sets: '', reps: '', defaultWeight: '25', defaultSets: '3', defaultReps: '12' }, { id: generateSeedId('ex_'), prefix: '‚Ä¢ ', name: 'Barbell Hip Thrust', weight: '', sets: '', reps: '', defaultWeight: '100', defaultSets: '3', defaultReps: '15' }, { id: generateSeedId('ex_'), prefix: '‚Ä¢ ', name: 'Leg Extensions', weight: '', sets: '', reps: '', defaultWeight: '50', defaultSets: '3', defaultReps: '15' }, { id: generateSeedId('ex_'), prefix: '‚Ä¢ ', name: 'Seated Chest Flyes', weight: '', sets: '', reps: '', defaultWeight: '15', defaultSets: '3', defaultReps: '15' }, { id: generateSeedId('ex_'), prefix: '‚Ä¢ SS: ', name: 'Standing Calf Raises', weight: '', sets: '', reps: '', defaultWeight: '30', defaultSets: '3', defaultReps: '15' }, { id: generateSeedId('ex_'), prefix: '‚Ä¢ SS: ', name: 'Reverse Cable Flyes', weight: '', sets: '', reps: '', defaultWeight: '20', defaultSets: '3', defaultReps: '15' } ]} ],
        meals_default: [ { id: generateSeedId('meal_'), name: 'Nutty Pudding', ingredients: 'Berries ¬Ωc, Cherries 3, Pomegranate Juice 2oz, Macadamia nuts (raw) 45g, Walnuts (raw) 5g, Cocoa 1t, Brazil Nuts ¬º, Milk 50-100ml, Chia Seeds 2T, Flax (ground, refr) 1t, Lecithin 1t, Ceylon Cinnamon ¬Ωt' }, { id: generateSeedId('meal_'), name: 'Super Veggie', ingredients: 'Broccoli 250g, Cauliflower 150g, Mushrooms 50g, Garlic 1 clove, Ginger 3g, Cumin 1T, Black Lentils 45g, Hemp Seeds 1T, Apple Cider Vinegar 1T' }, { id: generateSeedId('meal_'), name: 'Third Meal', ingredients: 'Sweet Potato 350-400g, Protein 100-150g, Grape Tomatoes 12, Avocado ¬Ω, Radishes 4, Cilantro ¬ºc, Lemon 1, Jalape√±o (lg) 1, Chili Powder 1t' } ],
        grocery_list_default: [ { id: generateSeedId('gcat_'), name: 'Produce', items: 'Broccoli 1.75kg, Cauliflower 1.05kg, Mushrooms 350g, Garlic 1 bulb, Ginger 1pc, Sweet Potato 2.8kg, Grape Tomatoes 84, Avocados (ripe) 4, Radishes 28, Cilantro 2-3 bunch' }, { id: generateSeedId('gcat_'), name: 'Fruits & Protein', items: 'Lemons 7, Jalape√±os (lg) 7, Berries 3.5c, Cherries 21, Black Lentils 315g, Protein 1.05kg, Milk (fortified) 1L' } ],
        grocery_budget_default_placeholder: "¬£120",
        body_measurements_default: [ { id: generateSeedId('bm_'), name: 'Weight', value: '', placeholder: '75kg' }, { id: generateSeedId('bm_'), name: 'Chest', value: '', placeholder: '42in' }, { id: generateSeedId('bm_'), name: 'Waist', value: '', placeholder: '34in' }, { id: generateSeedId('bm_'), name: 'Hips', value: '', placeholder: '40in' }, { id: generateSeedId('bm_'), name: 'Arms', value: '', placeholder: '15in' }, { id: generateSeedId('bm_'), name: 'Thighs', value: '', placeholder: '24in' } ],
        financials_default: [ { id: generateSeedId('fin_'), name: 'Rent', value: '', placeholder: '850', account: 'Cash' }, { id: generateSeedId('fin_'), name: 'Allowance', value: '', placeholder: '850', account: 'Revolut' }, { id: generateSeedId('fin_'), name: 'Savings', value: '', placeholder: '3,800', account: 'HSBCUK' } ]
    };
    // --- End of Seed Data ---


        async function runSetupWithToken() {
            logElement.innerHTML = 'Setup log will appear here...';
            log("Setup process started (with token)...");

            const pbUrl = document.getElementById('pb_url').value;
            const adminToken = document.getElementById('admin_token').value;

            if (!pbUrl || !adminToken) {
                log("PocketBase URL and Admin Token are required.", "error");
                alert("PocketBase URL and Admin Token are required.");
                return;
            }

            const pb = new PocketBase(pbUrl);
            
            try {
                // Impersonate admin using the token
                pb.authStore.save(adminToken, null); // Second arg is model, can be null for admin
                // Verify admin auth by trying a protected admin-only action, e.g., listing collections
                await pb.collections.getList(1,1); // Simple check
                log("Admin token authenticated (or at least accepted by SDK). Proceeding with setup...", "success");

                // 1. Ensure 'planners' collection exists (or create it)
                try {
                    await pb.collections.getOne(plannersCollectionSchema.name);
                    log(`Collection '${plannersCollectionSchema.name}' already exists.`, "info");
                } catch (e) {
                    if (e.status === 404) {
                        log(`Collection '${plannersCollectionSchema.name}' not found, creating...`, "info");
                        await pb.collections.create(plannersCollectionSchema);
                        log(`Collection '${plannersCollectionSchema.name}' created successfully.`, "success");
                    } else { throw e; }
                }

                // 2. Ensure 'app_config' collection exists (or create it)
                try {
                    await pb.collections.getOne(appConfigCollectionSchema.name);
                    log(`Collection '${appConfigCollectionSchema.name}' already exists.`, "info");
                } catch (e) {
                    if (e.status === 404) {
                        log(`Collection '${appConfigCollectionSchema.name}' not found, creating...`, "info");
                        await pb.collections.create(appConfigCollectionSchema);
                        log(`Collection '${appConfigCollectionSchema.name}' created successfully.`, "success");
                    } else { throw e; }
                }

                // 3. Seed/Update the 'app_config' record
                let existingConfigRecord = null;
                try {
                    existingConfigRecord = await pb.collection('app_config').getFirstListItem(`config_key="${SEED_APP_CONFIG_RECORD_DATA.config_key}"`);
                } catch (e) { if (e.status !== 404) throw e; }

                if (existingConfigRecord) {
                    await pb.collection('app_config').update(existingConfigRecord.id, SEED_APP_CONFIG_RECORD_DATA);
                    log(`Updated app_config record: ${SEED_APP_CONFIG_RECORD_DATA.config_key}`, "success");
                } else {
                    await pb.collection('app_config').create(SEED_APP_CONFIG_RECORD_DATA);
                    log(`Created new app_config record: ${SEED_APP_CONFIG_RECORD_DATA.config_key}`, "success");
                }
                
                log("---------------------------------------------------------", "info");
                log("DATABASE SETUP AND SEEDING COMPLETED SUCCESSFULLY!", "success");
                log("You can now close this utility page and use your main application.", "info");
                log("---------------------------------------------------------", "info");
                alert("Database setup and seeding completed successfully!");

            } catch (error) {
                log(`SETUP/SEEDING FAILED: ${error.message}`, "error");
                if (error.data && Object.keys(error.data).length > 0) { // Check if error.data has content
                    log(`Error details: ${JSON.stringify(error.data)}`, "error");
                } else if (error.originalError) { // For some SDK errors
                     log(`Original error: ${error.originalError}`, "error");
                }
                alert(`Database setup/seeding failed: ${error.message}. Check console for details.`);
            } finally {
                pb.authStore.clear(); // Clear the impersonated token
                log("Admin session (from token) cleared.", "info");
            }
        }
        // Make it globally available if button is outside this script block
        window.runSetupWithToken = runSetupWithToken; 
    </script>
</body>
</html>
