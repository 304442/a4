<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Automated Browser Test</title>
    <script src="pocketbase.umd.js"></script>
    <script type="module" src="assets/index-BLNEHanq.js"></script>
    <link rel="stylesheet" href="assets/index-CzxDvdnt.css">
</head>
<body>
    <div id="app"></div>
    <div id="test-results" style="position: fixed; bottom: 0; left: 0; right: 0; background: #f0f0f0; padding: 20px; font-family: monospace; max-height: 50vh; overflow-y: auto;"></div>
    
    <script>
        const results = document.getElementById('test-results');
        let testCount = 0;
        
        function log(message, type = 'info') {
            const color = { info: 'black', success: 'green', error: 'red', warning: 'orange' }[type];
            results.innerHTML += `<div style="color: ${color}">[${++testCount}] ${message}</div>`;
            console.log(`[${type}] ${message}`);
        }
        
        // Override console.log to capture messages
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            log('Console: ' + args.join(' '), 'info');
        };
        
        // Override console.error
        const originalError = console.error;
        console.error = function(...args) {
            originalError.apply(console, args);
            log('Error: ' + args.join(' '), 'error');
        };
        
        window.addEventListener('error', (e) => {
            log(`Global error: ${e.message} at ${e.filename}:${e.lineno}:${e.colno}`, 'error');
        });
        
        // Start tests after a delay
        setTimeout(() => {
            log('Starting tests...', 'info');
            
            // Test 1: PocketBase
            if (window.PocketBase) {
                log('PocketBase is loaded', 'success');
            } else {
                log('PocketBase NOT loaded', 'error');
            }
            
            // Test 2: plannerStore
            if (window.plannerStore) {
                log('plannerStore exists', 'success');
                log(`plannerStore.isInitializing = ${window.plannerStore.isInitializing}`, 'info');
                log(`plannerStore.showSetupModal = ${window.plannerStore.showSetupModal}`, 'info');
            } else {
                log('plannerStore NOT found', 'error');
            }
            
            // Test 3: DOM content
            const app = document.getElementById('app');
            log(`App element children: ${app.children.length}`, 'info');
            
            // Test 4: Setup notification
            const notification = document.querySelector('.setup-notification');
            if (notification) {
                log('Setup notification found!', 'success');
                log(`Notification HTML: ${notification.outerHTML}`, 'info');
            } else {
                log('Setup notification NOT found', 'warning');
                
                // Try to trigger it manually
                if (window.plannerStore && window.plannerStore.showSetupNotification) {
                    log('Manually triggering showSetupNotification...', 'info');
                    window.plannerStore.showSetupNotification();
                    
                    setTimeout(() => {
                        const notif2 = document.querySelector('.setup-notification');
                        if (notif2) {
                            log('Setup notification now exists after manual trigger!', 'success');
                        } else {
                            log('Setup notification still missing after manual trigger', 'error');
                        }
                    }, 500);
                }
            }
            
            // Test 5: Check all elements with class setup-notification
            setTimeout(() => {
                const allNotifs = document.querySelectorAll('[class*="setup"]');
                log(`Elements containing "setup" in class: ${allNotifs.length}`, 'info');
                allNotifs.forEach((el, i) => {
                    log(`  [${i}] ${el.tagName}.${el.className}`, 'info');
                });
                
                // Check body for any notification-like elements
                const bodyHTML = document.body.innerHTML;
                if (bodyHTML.includes('Database not initialized')) {
                    log('Found "Database not initialized" text in body', 'success');
                } else {
                    log('"Database not initialized" text NOT found in body', 'error');
                }
            }, 1000);
            
        }, 2000);
    </script>
</body>
</html>